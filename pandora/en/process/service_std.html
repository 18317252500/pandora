<!DOCTYPE html>
<html lang="en">
<head>
  <title>Custom service - Ready to Boot</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/pandora/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/pandora/en" class="nav-logo leftpadding" alt="Pandora.js"><img src="/pandora/images/nav-logo.png" > Pandora.js</a>
    <ul class="nav-item">
      <li><a href="/pandora/en/introduce.html" alt="Documentation">Documentation</a></li><li><a href="/pandora/en/api.html" alt="API reference">API reference</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="Change Log">Change Log</a></li>
      <li class="translations">
        <a class="nav-link">English</a>
        <span class="arrow" style="border-top-color:#fff" ></span>
        <ul class="dropdown-content" >
          <li style="display: block; margin-left: 20px" ><a style="color: #008ce6" href="/pandora/zh-cn">中文</a></li>
          <li style="display: block; margin-left: 20px" ><a style="color: #008ce6" href="/pandora/en">English</a></li>
        </ul>
      </li>
      <li><iframe src="https://ghbtns.com/github-btn.html?user=midwayjs&repo=pandora&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>Custom service</h1>
    <h2 id="what-is-service"><a class="markdown-anchor" href="#what-is-service">#</a> What is Service?</h2>
<p>Service is also like <code>process('x).entry('./y.js')</code> similarly, define the Node.js program in the process. But it's more structured, and provides the following basic capabilities:</p>
<ol>
<li>The standard <code>async start()</code> interface allows the user to asynchronous start the Node.js program.</li>
<li>The standard <code>async stop()</code> interface allows users to have elegant offline Nodes.js programs (for example, elegant offline RPC services, to avoid service flash break).</li>
<li>Structured log management, and configure capabilities.</li>
<li>Start-up order (dependency relationship) management in the process.</li>
</ol>
<h2 id="how-to-get-service"><a class="markdown-anchor" href="#how-to-get-service">#</a> How to get Service</h2>
<ol>
<li>User can be obtained by <code>require('dorapan').getService(serviceName)</code>.</li>
<li>This method is also available in the Service builder with the passed-in ServiceContext.</li>
</ol>
<h2 id="how-to-define-service"><a class="markdown-anchor" href="#how-to-define-service">#</a> How to define Service</h2>
<p>Process is defined in procfile.js, depending on the following syntax:</p>
<p><code>procfile.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">pandora</span>) </span>&#123;</span><br><span class="line">  pandora</span><br><span class="line">    .service(<span class="string">'serviceName'</span>, <span class="string">'./service.js'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>pandora. service('serviceName', './service.js')</code> means that defines a Service called <code>serviceName</code>, and define the implementation of the Service in <code>./service.js</code>.</p>
<p>The second parameter can also pass a reference to an implementation class in addition to passing a relative path.
In the end, the statement returns an object, <a href="http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicerepresentationchainmodifier.html" target="_blank" rel="noopener">ServiceRepresentationChainModifier</a>.</p>
<p>We can use <a href="http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicerepresentationchainmodifier.html" target="_blank" rel="noopener">ServiceRepresentationChainModifier</a> to improve the definition of this service.</p>
<p>The following is a simple example of all of the definition capabilities:</p>
<p><code>procfile.js</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">pandora</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define a service named serviceA</span></span><br><span class="line">  <span class="comment">// The second parameter is a specific implementation, can be an address, or a reference to an implementation class</span></span><br><span class="line">  <span class="comment">// If the second parameter is not passed, the defined Service are modified</span></span><br><span class="line">  pandora(<span class="string">'serviceA'</span>, <span class="string">'./ServiceA'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Rename Service</span></span><br><span class="line">    <span class="comment">// Obtained without passing parameters</span></span><br><span class="line">    .name(<span class="string">'renameIt'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Specify the process that is assigned to, by default being worker</span></span><br><span class="line">    <span class="comment">// You can use `pandora.defaultServiceCategory('worker')` to modify the default value.</span></span><br><span class="line">    <span class="comment">// Obtained without passing parameters</span></span><br><span class="line">    .process(<span class="string">'worker'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Configure to Service</span></span><br><span class="line">    <span class="comment">// Obtained without passing parameters</span></span><br><span class="line">    .config(&#123;</span><br><span class="line">      port: <span class="number">5555</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define dependency, the following means that the serviceX must start with this service</span></span><br><span class="line">    <span class="comment">// Obtained without passing parameters</span></span><br><span class="line">    .dependency([<span class="string">'serviceX'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The service is published at the IPC-Hub, specifically refer to the [《Inter-Process Communication Hub》](http://www.midwayjs.org/pandora/zh-cn/process/ipc_hub.html)</span></span><br><span class="line">    <span class="comment">// .publish(false) To cancel the release</span></span><br><span class="line">    .publish()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Drop: (Delete) the service definition</span></span><br><span class="line">    .drop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="the-value-of-seriveprocessprocessname-string"><a class="markdown-anchor" href="#the-value-of-seriveprocessprocessname-string">#</a> The value of <code>serive().process(processName: string)</code></h3>
<p>The <code>processName</code> in <code>service().process(processName: string)</code> can have the following values:</p>
<ol>
<li>A process name that has been defined.</li>
<li>'weak-all', all processes that have been activated (via entry or other Service), but they do not activate any processes themselves.</li>
<li>'all', all processes that defined (Will activate all defined processes, including built-in default definitions, not recommended for use).</li>
</ol>
<h3 id="modify-the-process-for-the-default-allocation"><a class="markdown-anchor" href="#modify-the-process-for-the-default-allocation">#</a> Modify the Process for the default allocation</h3>
<p>Use the <code>pandora.defaultServiceCategory()</code> mentioned above to modify.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">pandora</span>) </span>&#123;</span><br><span class="line">  pandora.defaultServiceCategory(<span class="string">'processName'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="how-to-implement-a-service"><a class="markdown-anchor" href="#how-to-implement-a-service">#</a> How to implement a Service</h2>
<p>Each service is a Class that needs to implement 0 required interfaces, and four optional interfaces.</p>
<p><strong>new (context: <a href="http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicecontextaccessor.html" target="_blank" rel="noopener">ServiceContextAccessor</a>)</strong></p>
<blockquote>
<p>Optional, the first parameter of the builder is a ServiceContextAccessor, the service context object, as described below.</p>
</blockquote>
<p><strong>start(): Promise&lt;void&gt; | void</strong></p>
<blockquote>
<p>Optional, life cycle methods, start the service.</p>
</blockquote>
<p><strong>stop?(): Promise&lt;void&gt; | void</strong></p>
<blockquote>
<p>Optional, life cycle methods, stop the service. The Pandora.js gives a 5-second time window for an elegant exit at the time of the stop.</p>
</blockquote>
<h4 id="static-attribute-method-constraint"><a class="markdown-anchor" href="#static-attribute-method-constraint">#</a> Static attribute, method constraint</h4>
<p><strong>dependencies: string[]</strong></p>
<blockquote>
<p>Optional, also known as the static property in the class system. Define the dependency of a certain service.</p>
</blockquote>
<h2 id="the-main-interface-provided-by-servicecontextaccessor"><a class="markdown-anchor" href="#the-main-interface-provided-by-servicecontextaccessor">#</a> The main interface provided by ServiceContextAccessor</h2>
<p>There are a lot of attributes and methods on this, specific reference <a href="http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicecontextaccessor.html" target="_blank" rel="noopener">ServiceContextAccessor</a> API. Here are a few common:</p>
<h4 id="primary-attribute"><a class="markdown-anchor" href="#primary-attribute">#</a> Primary attribute</h4>
<p><strong>serviceName: string</strong></p>
<blockquote>
<p>The name of Service</p>
</blockquote>
<p><strong>config: any</strong></p>
<blockquote>
<p>Configuration for Service, defined in <code>.service().config({ key: 'value' })</code>.</p>
</blockquote>
<p><strong>dependencies: { [depName: string]: Service }</strong></p>
<blockquote>
<p>All the Service instance that dependent.</p>
</blockquote>
<p><strong>logger: ServiceLogger</strong></p>
<blockquote>
<p>Service proprietary log objects, log file to <code>${logsDir}/${appName}/service.log</code>.</p>
</blockquote>
<h3 id="unit-test"><a class="markdown-anchor" href="#unit-test">#</a> Unit test</h3>
<p>You can directly <code>new</code> your implementation class to write the unit test.</p>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="/pandora/en/introduce.html" alt="Documentation">Documentation</a></li><li><a href="/pandora/en/api.html" alt="API reference">API reference</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="Change Log">Change Log</a></li></ul>
  </div>
  <dl><dt><a href="/pandora/en/introduce.html">What is the Pandora.js</a></dt></ul></dd><dt><a href="/pandora/en/quickstart.html">Quick Start</a></dt></ul></dd><dt><a href="/pandora/en/glossary.html">Glossary</a></dt></ul></dd><dt>Basic Features</dt><dd><ul><li><a href="/pandora/en/base/command.html">Commands</a></li><li><a href="/pandora/en/base/procfile_mode.html">Understand procfile.js</a></li><li><a href="/pandora/en/base/dorapan.html">User SDK - Dorapan</a></li><li><a href="/pandora/en/base/logs.html">Logger</a></li><li><a href="/pandora/en/base/global_config.html">Global Config</a></li><li><a href="/pandora/en/base/quick_monitor.html">Monitoring Quick Start</a></li><li><a href="/pandora/en/base/debug.html">Debugging</a></li></ul></dd><dt>Advanced Processes Model</dt><dd><ul><li><a href="/pandora/en/process/process_std.html">Custom Process</a></li><li><a href="/pandora/en/process/service_std.html">Custom Service</a></li><li><a href="/pandora/en/process/fork_and_cluster.html">Fork And Cluster</a></li><li><a href="/pandora/en/process/environment_std.html">Custom Environment</a></li><li><a href="/pandora/en/process/application_life_cycle.html">Application Life Cycle</a></li><li><a href="/pandora/en/process/ipc_hub.html">IPC-Hub</a></li></ul></dd><dt>Application Monitoring</dt><dd><ul><li><a href="/pandora/en/monitor/monitor_std.html">Overview of Monitoring</a></li><li><a href="/pandora/en/monitor/endpoint.html">EndPoint usage and extension</a></li><li><a href="/pandora/en/monitor/resource.html">Expose RESTFul API</a></li><li><a href="/pandora/en/monitor/metrics.html">Metrics usage and extension</a></li><li><a href="/pandora/en/monitor/trace.html">Trace business logic link</a></li><li><a href="/pandora/en/monitor/monitor_inner.html">Base Monitoring</a></li><li><a href="/pandora/en/monitor/report.html">Monitoring Data Report</a></li></ul></dd><dt>Monitoring Data Collection</dt><dd><ul><li><a href="/pandora/en/collect/health.html">Health Check</a></li></ul></dd><dt>Extension</dt><dd><ul><li><a href="/pandora/en/other/dashboard.html">GUI Dashboard</a></li><li><a href="/pandora/en/other/typescript.html">Start A TypeScript Project</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  e.preventDefault();
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<div class="cnzz">
<script src="https://s19.cnzz.com/z_stat.php?id=1271324644&web_id=1271324644" language="JavaScript"></script>
</div>

</html>
