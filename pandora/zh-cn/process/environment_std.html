<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <title>自定义环境（Environment） - Ready to boot</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/pandora/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/pandora/zh-cn" class="nav-logo leftpadding" alt="Pandora.js"><img src="/pandora/images/nav-logo.png" > Pandora.js</a>
    <ul class="nav-item">
      <li><a href="/pandora/zh-cn/introduce.html" alt="文档指南">文档指南</a></li><li><a href="/pandora/zh-cn/api.html" alt="API 接口">API 接口</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="发布日志">发布日志</a></li>
      <!--
      <li class="translations">
        <a class="nav-link">header.translations</a>
        <span class="arrow"></span>
        <ul class="dropdown-content">
          <li><a href="/">中文</a></li>
          <li><a href="/">English</a></li>
        </ul>
      </li>
      -->
      <li><iframe src="https://ghbtns.com/github-btn.html?user=midwayjs&repo=pandora&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>自定义环境（Environment）</h1>
    <p>用于抽象环境相关的内容，比如识别生产环境还是开发环境、以及其他扩展的环境相关变量（比如机房信息）。</p>
<h2 id="如何获取"><a class="markdown-anchor" href="#如何获取">#</a> 如何获取</h2>
<p>用户可以通过 <code>require('pandora').environment</code> 获得该对象。</p>
<h2 id="如何定义"><a class="markdown-anchor" href="#如何定义">#</a> 如何定义</h2>
<ol>
<li>可以在全局配置中设置，参考全局配置一章。</li>
<li>可以在 procfile.js 中设置，如：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">pandora</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 不传参数则获取</span></span><br><span class="line">  pandora.environment(UrEnvironmentClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="主要接口"><a class="markdown-anchor" href="#主要接口">#</a> 主要接口</h2>
<p>最基本的 Environment 对象是约束于 Interface <a href="https://midwayjs.github.io/pandora/api-reference/env/interfaces/environment.html" target="_blank" rel="noopener">Environment</a> 。</p>
<p>简单的来说包含以下方法：</p>
<p><strong>get(name: string): any</strong></p>
<blockquote>
<p>通过一个 name 获得特定的上下文变量</p>
<p>保留意义的变量名：</p>
<ol>
<li>env -&gt; 当前环境的标识字符串，如 production 、development</li>
<li>appName -&gt; 当前应用名</li>
<li>appDir -&gt; 当前应用路径</li>
<li>pandoraLogsDir -&gt; Pandora 日志路径，默认为 <code>~/logs</code></li>
</ol>
</blockquote>
<p><strong>match(name: string): boolean</strong></p>
<blockquote>
<p>通过一个 name (当前环境的标识字符串) 来匹配当前环境，返回布尔型。</p>
</blockquote>
<h2 id="建议使用的基础实现-抽象类-baseenvironment"><a class="markdown-anchor" href="#建议使用的基础实现-抽象类-baseenvironment">#</a> 建议使用的基础实现 - 抽象类 BaseEnvironment</h2>
<p>这里我们建议直接继承我们的基础实现 BaseEnvironment，通过<code>import {BaseEnvironment} from 'pandora'</code>获得。</p>
<p>详细参见类型信息： <a href="https://midwayjs.github.io/pandora/api-reference/env/classes/baseenvironment.html" target="_blank" rel="noopener">BaseEnvironment</a></p>
<p>该类扩展出 <code>constructor()</code>、<code>set()</code> 等默认行为与方法。</p>
<p>下面是一个例子</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;BaseEnvironment&#125; <span class="keyword">from</span> <span class="string">'pandora'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> ForceTestEnvironment <span class="keyword">extends</span> BaseEnvironment &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">variables?: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    variables = variables || &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span>(!variables.env) &#123;</span><br><span class="line">      variables.env = <span class="string">'test'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>(variables);</span><br><span class="line">  &#125;</span><br><span class="line">  match(name: <span class="built_in">string</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.get(<span class="string">'env'</span>) === name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="默认行为-defaultenvironment"><a class="markdown-anchor" href="#默认行为-defaultenvironment">#</a> 默认行为 - DefaultEnvironment</h2>
<p>如果用户不注入自定义的 Environment 类，我们将使用默认的 <a href="https://midwayjs.github.io/pandora/api-reference/env/classes/defaultenvironment.html" target="_blank" rel="noopener">DefaultEnvironment</a> 。</p>
<p>该类主要是基于 <code>process.env.NODE_ENV</code> 判读当前环境，主要实现如下：</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> (process.env.NODE_ENV) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'production'</span>:</span><br><span class="line">    variables.env = <span class="string">'production'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'prepub'</span>:</span><br><span class="line">    variables.env = <span class="string">'prepub'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'test'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'unittest'</span>:</span><br><span class="line">    variables.env = <span class="string">'test'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    variables.env = <span class="string">'development'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="/pandora/zh-cn/introduce.html" alt="文档指南">文档指南</a></li><li><a href="/pandora/zh-cn/api.html" alt="API 接口">API 接口</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="发布日志">发布日志</a></li></ul>
  </div>
  <dl><dt><a href="/pandora/zh-cn/introduce.html">Pandora.js 是什么？</a></dt></ul></dd><dt><a href="/pandora/zh-cn/quickstart.html">快速入门</a></dt></ul></dd><dt><a href="/pandora/zh-cn/glossary.html">关键术语</a></dt></ul></dd><dt>基础功能</dt><dd><ul><li><a href="/pandora/zh-cn/base/command.html">命令行介绍</a></li><li><a href="/pandora/zh-cn/base/procfile_mode.html">认识 procfile.js</a></li><li><a href="/pandora/zh-cn/base/logs.html">日志管理</a></li><li><a href="/pandora/zh-cn/base/global_config.html">配置文件</a></li><li><a href="/pandora/zh-cn/base/quick_monitor.html">快速了解监控</a></li><li><a href="/pandora/zh-cn/base/debug.html">调试应用</a></li></ul></dd><dt>进程管理进阶</dt><dd><ul><li><a href="/pandora/zh-cn/process/process_std.html">自定义进程</a></li><li><a href="/pandora/zh-cn/process/service_std.html">自定义 Service</a></li><li><a href="/pandora/zh-cn/process/fork_and_cluster.html">Fork 和 Cluster</a></li><li><a href="/pandora/zh-cn/process/environment_std.html">自定义环境</a></li><li><a href="/pandora/zh-cn/process/application_life_cycle.html">应用生命周期</a></li><li><a href="/pandora/zh-cn/process/ipc_hub.html">进程间通信</a></li></ul></dd><dt>标准监控体系</dt><dd><ul><li><a href="/pandora/zh-cn/monitor/monitor_std.html">监控体系介绍</a></li><li><a href="/pandora/zh-cn/monitor/endpoint.html">使用和扩展 EndPoint</a></li><li><a href="/pandora/zh-cn/monitor/resource.html">对外暴露 Resource</a></li><li><a href="/pandora/zh-cn/monitor/metrics.html">使用和扩展 Metrics</a></li><li><a href="/pandora/zh-cn/monitor/trace.html">链路监控</a></li><li><a href="/pandora/zh-cn/monitor/monitor_inner.html">默认监控</a></li></ul></dd><dt>扩展功能</dt><dd><ul><li><a href="/pandora/zh-cn/other/dashboard.html">单机可视化管理面板</a></li><li><a href="/pandora/zh-cn/other/typescript.html">启动 TypeScript 项目</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  e.preventDefault();
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<div class="cnzz">
<script src="https://s19.cnzz.com/z_stat.php?id=1271324644&web_id=1271324644" language="JavaScript"></script>
</div>

</html>
