<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <title>监控体系介绍 - Ready to boot</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/pandora/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/zh-cn/" class="nav-logo leftpadding" alt="egg"><img src="/images/nav-logo.png"> Pandora.js</a>
    <ul class="nav-item">
      <li><a href="/zh-cn/introduce.html" alt="文档指南">文档指南</a></li><li><a href="/zh-cn/api.html" alt="API 接口">API 接口</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="发布日志">发布日志</a></li>
      <!--
      <li class="translations">
        <a class="nav-link">header.translations</a>
        <span class="arrow"></span>
        <ul class="dropdown-content">
          <li><a href="/">中文</a></li>
          <li><a href="/">English</a></li>
        </ul>
      </li>
      -->
      <li><iframe src="https://ghbtns.com/github-btn.html?user=midwayjs&repo=pandora&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>监控体系介绍</h1>
    <p>在业界应用的监控已经是很常见的了，特别是分布式系统中，监控已经是不可获取的一部分，而 Metrics 作为监控的一大标准，已经出现在各个地方，最近在微服务领域也有 Metrics 的身影，通过它，我们可以可以了解系统的运行状况，健康状况，性能状况等等，通过对历史数据的分析，也可以帮助我们发现系统缺陷和避免系统不稳定的发生。</p>
<p>Pandora.js 提供了一套简单的监控机制，包含但不限于 Metrics，让用户可以在应用中采集自己的数据，并且通过一定的机制可以让外部系统收集和计算。</p>
<p>Pandora.js 的整个监控体系分为两个大部分，数据采集机制和数据透出机制，我们将一一来描述。</p>
<h2 id="数据采集机制"><a class="markdown-anchor" href="#数据采集机制">#</a> 数据采集机制</h2>
<p>Pandora.js 的数据采集分为几块内容，简单来说，分为 <code>服务端</code> 和 <code>客户端</code> ，基本上是一对多的关系，一个服务端接受多个客户端的返回数据，并且汇总，储存在内存中。</p>
<p>数据的采集是通过 <code>EndPoint</code> 和 <code>Indicator</code> 来完成的。</p>
<h3 id="endpoint-采集机制"><a class="markdown-anchor" href="#endpoint-采集机制">#</a> EndPoint 采集机制</h3>
<p><code>EndPoint</code> 可以看做服务端，用来接收客户端返回的数据。</p>
<p>而客户单，我们叫做 <code>indicator</code>，用来真正执行逻辑，将数据上报给服务端。</p>
<p>而服务端和客户端通过 IPC 进行通信，这样对应的模型就变成了以下的样子。</p>
<p><img src="https://private-alipayobjects.alipay.com/alipay-rmsdeploy-image/skylark/png/5cb69c75-e878-4246-b11e-d41b5164aea0.png" alt=""></p>
<p>我们有一些比较常用的 EndPoint ，比如健康检查，运行时数据访问等，只要是希望通过客户端披露的，都可以通过 EndPoint 机制来完成。</p>
<h3 id="metrics-采集机制"><a class="markdown-anchor" href="#metrics-采集机制">#</a> Metrics 采集机制</h3>
<p>标准的 metrics ，支持几种标准类型</p>
<ul>
<li>Gauge 瞬时值</li>
<li>Counter 计数器</li>
<li>Meter 吞吐率度量器</li>
<li>Histogram 直方分布度量器</li>
<li>Timer 吞吐率和响应时间分布度量器</li>
</ul>
<p>Pandora.js 对这几种类型都做了一定程度的支持，但是 Gauge 和 Counter 类型最为常用。</p>
<p>这些类型有一些基础类，也有一些实现类，在使用的时候可以自行选择。</p>
<h2 id="数据透出"><a class="markdown-anchor" href="#数据透出">#</a> 数据透出</h2>
<p>每个 EndPoint ，采集了各种各样的数据，但是还不能被用户或者外部采集器获取，所以我们定义了两种不同的方式来进行对外暴露，Resource 和 Reporter 机制就是其中的两种策略。</p>
<h3 id="resource-机制"><a class="markdown-anchor" href="#resource-机制">#</a> Resource 机制</h3>
<p>在应用运行中，虽然有 EndPoint 在服务端汇总客户端的数据，但是用户依旧无法获取或者接触到这部分的数据，我们设计了一套 Resource 机制，将 EndPoint 的结果通过 HTTP 协议暴露出来，这样用户就能直观的拿到这些结果。</p>
<p>比如健康检查，我们提供了 <code>/health</code> 路由，这样用户可以通过该路由直接拿到每个客户端的状态，如果这些客户端埋入到了中间件中，就能直接获取中间件的状态。</p>
<h3 id="reporter-机制"><a class="markdown-anchor" href="#reporter-机制">#</a> Reporter 机制</h3>
<p>这是另一种对外暴露数据的方式，我们往往采集了数据还不够，还需要进行数据存储，分析，再加工，而 Pandora 不做这些事情，而需要外部的 APM 平台来做，比如 oneApm 或者 open-falcon 等，这个时候 Reporter 就有用了。</p>
<p>Reporter 定义了一系列数据输出方式，默认的有一些：</p>
<ul>
<li>ConsoleReporter 通过命令行输出 MetricsEndPint 的内容</li>
<li>FileMetricsReporter 通过 metrics.log 文本来输出 MetricsEndPint 的内容</li>
</ul>
<blockquote>
<p>注意，MetricsEndPoint 是一个特殊的存在，大多数 APM 只需要采集这个 EndPoint，如果框架或者用户想采集其他的 EndPoint，可以通过 Resource 暴露的 HTTP API 或者自定义 Reporter 的方式。</p>
</blockquote>
<p>当然你也可以自定义 Reporter，把数据发送到不同的地方，我们也提供了一些外部 APM 的 Reporter，请通过 <a href="https://www.npmjs.com/search?q=pandora-reporter" target="_blank" rel="noopener">这里</a> 查看。</p>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="/zh-cn/introduce.html" alt="文档指南">文档指南</a></li><li><a href="/zh-cn/api.html" alt="API 接口">API 接口</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="发布日志">发布日志</a></li></ul>
  </div>
  <dl><dt><a href="/zh-cn/introduce.html">Pandora.js 是什么？</a></dt></ul></dd><dt><a href="/zh-cn/quickstart.html">快速入门</a></dt></ul></dd><dt><a href="/zh-cn/glossary.html">关键术语</a></dt></ul></dd><dt>基础功能</dt><dd><ul><li><a href="/zh-cn/base/command.html">命令行介绍</a></li><li><a href="/zh-cn/base/procfile_mode.html">认识 procfile.js</a></li><li><a href="/zh-cn/base/logs.html">日志管理</a></li><li><a href="/zh-cn/base/global_config.html">配置文件</a></li><li><a href="/zh-cn/base/monitor_inner.html">默认监控</a></li><li><a href="/zh-cn/base/debug.html">调试应用</a></li></ul></dd><dt>进程管理进阶</dt><dd><ul><li><a href="/zh-cn/process/process_std.html">自定义进程</a></li><li><a href="/zh-cn/process/service_std.html">自定义 Service</a></li><li><a href="/zh-cn/process/fork_and_cluster.html">Fork 和 Cluster</a></li><li><a href="/zh-cn/process/environment_std.html">自定义环境</a></li><li><a href="/zh-cn/process/application_life_cycle.html">应用生命周期</a></li><li><a href="/zh-cn/process/ipc_hub.html">进程间通信</a></li></ul></dd><dt>标准监控体系</dt><dd><ul><li><a href="/zh-cn/monitor/monitor_std.html">监控体系介绍</a></li><li><a href="/zh-cn/monitor/endpoint.html">使用和扩展 EndPoint</a></li><li><a href="/zh-cn/monitor/resource.html">对外暴露 Resource</a></li><li><a href="/zh-cn/monitor/metrics.html">使用和扩展 Metrics</a></li><li><a href="/zh-cn/monitor/trace.html">链路监控</a></li></ul></dd><dt>扩展功能</dt><dd><ul><li><a href="/zh-cn/other/dashboard.html">单机可视化管理面板</a></li><li><a href="/zh-cn/other/typescript.html">启动 TypeScript 项目</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  e.preventDefault();
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<div class="cnzz">
<script src="https://s19.cnzz.com/z_stat.php?id=1271324644&web_id=1271324644" language="JavaScript"></script>
</div>

</html>
