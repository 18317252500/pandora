(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{220:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),s("p",[t._v("Process is defined in procfile.js, depending on the following syntax:")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),s("p",[t._v("The second parameter can also pass a reference to an implementation class in addition to passing a relative path.\nIn the end, the statement returns an object, "),s("a",{attrs:{href:"http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicerepresentationchainmodifier.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ServiceRepresentationChainModifier"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("p",[t._v("We can use "),s("a",{attrs:{href:"http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicerepresentationchainmodifier.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ServiceRepresentationChainModifier"),s("OutboundLink")],1),t._v(" to improve the definition of this service.")]),t._v(" "),s("p",[t._v("The following is a simple example of all of the definition capabilities:")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),s("p",[t._v("Each service is a Class that needs to implement 0 required interfaces, and four optional interfaces.")]),t._v(" "),s("p",[s("strong",[t._v("new (context: "),s("a",{attrs:{href:"http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicecontextaccessor.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ServiceContextAccessor"),s("OutboundLink")],1),t._v(")")])]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),s("p",[t._v("There are a lot of attributes and methods on this, specific reference "),s("a",{attrs:{href:"http://www.midwayjs.org/pandora/api-reference/pandora/classes/servicecontextaccessor.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ServiceContextAccessor"),s("OutboundLink")],1),t._v(" API. Here are a few common:")]),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"custom-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#custom-service","aria-hidden":"true"}},[this._v("#")]),this._v(" Custom service")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"what-is-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#what-is-service","aria-hidden":"true"}},[this._v("#")]),this._v(" What is Service?")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Service is also like "),e("code",[this._v("process('x).entry('./y.js')")]),this._v(" similarly, define the Node.js program in the process. But it's more structured, and provides the following basic capabilities:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("The standard "),s("code",[t._v("async start()")]),t._v(" interface allows the user to asynchronous start the Node.js program.")]),t._v(" "),s("li",[t._v("The standard "),s("code",[t._v("async stop()")]),t._v(" interface allows users to have elegant offline Nodes.js programs (for example, elegant offline RPC services, to avoid service flash break).")]),t._v(" "),s("li",[t._v("Structured log management, and configure capabilities.")]),t._v(" "),s("li",[t._v("Start-up order (dependency relationship) management in the process.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"how-to-get-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-get-service","aria-hidden":"true"}},[this._v("#")]),this._v(" How to get Service")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("User can be obtained by "),e("code",[this._v("require('dorapan').getService(serviceName)")]),this._v(".")]),this._v(" "),e("li",[this._v("This method is also available in the Service builder with the passed-in ServiceContext.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"how-to-define-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-define-service","aria-hidden":"true"}},[this._v("#")]),this._v(" How to define Service")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("procfile.js")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("module"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pandora"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pandora\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("service")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'serviceName'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'./service.js'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("pandora. service('serviceName', './service.js')")]),this._v(" means that defines a Service called "),e("code",[this._v("serviceName")]),this._v(", and define the implementation of the Service in "),e("code",[this._v("./service.js")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("procfile.js")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("module"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pandora"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// Define a service named serviceA")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// The second parameter is a specific implementation, can be an address, or a reference to an implementation class")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// If the second parameter is not passed, the defined Service are modified")]),t._v("\n  pandora"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("service")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'serviceA'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'./ServiceA'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Rename Service")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Obtained without passing parameters")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("name")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'renameIt'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Specify the process that is assigned to, by default being worker")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// You can use `pandora.defaultServiceCategory('worker')` to modify the default value.")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Obtained without passing parameters")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("process")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'worker'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Configure to Service")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Obtained without passing parameters")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("config")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      port"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("5555")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Define dependency, the following means that the serviceX must start with this service")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Obtained without passing parameters")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("dependency")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token string"}},[t._v("'serviceX'")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// The service is published at the IPC-Hub, specifically refer to the [《Inter-Process Communication Hub》](http://www.midwayjs.org/pandora/zh-cn/process/ipc_hub.html)")]),t._v("\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// .publish(false) To cancel the release")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("publish")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{attrs:{class:"token comment"}},[t._v("// Drop: (Delete) the service definition")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("drop")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"the-value-of-serive-process-processname-string"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-value-of-serive-process-processname-string","aria-hidden":"true"}},[this._v("#")]),this._v(" The value of "),e("code",[this._v("serive().process(processName: string)")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("processName")]),this._v(" in "),e("code",[this._v("service().process(processName: string)")]),this._v(" can have the following values:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("A process name that has been defined.")]),this._v(" "),e("li",[this._v("'weak-all', all processes that have been activated (via entry or other Service), but they do not activate any processes themselves.")]),this._v(" "),e("li",[this._v("'all', all processes that defined (Will activate all defined processes, including built-in default definitions, not recommended for use).")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"modify-the-process-for-the-default-allocation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#modify-the-process-for-the-default-allocation","aria-hidden":"true"}},[this._v("#")]),this._v(" Modify the Process for the default allocation")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Use the "),e("code",[this._v("pandora.defaultServiceCategory()")]),this._v(" mentioned above to modify.")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("module"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pandora"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  pandora"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("defaultServiceCategory")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'processName'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"how-to-implement-a-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-to-implement-a-service","aria-hidden":"true"}},[this._v("#")]),this._v(" How to implement a Service")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Optional, the first parameter of the builder is a ServiceContextAccessor, the service context object, as described below.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("start(): Promise<void> | void")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Optional, life cycle methods, start the service.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("stop?(): Promise<void> | void")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Optional, life cycle methods, stop the service. The Pandora.js gives a 5-second time window for an elegant exit at the time of the stop.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"static-attribute-method-constraint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#static-attribute-method-constraint","aria-hidden":"true"}},[this._v("#")]),this._v(" Static attribute, method constraint")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("dependencies: string[]")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Optional, also known as the static property in the class system. Define the dependency of a certain service.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"the-main-interface-provided-by-servicecontextaccessor"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#the-main-interface-provided-by-servicecontextaccessor","aria-hidden":"true"}},[this._v("#")]),this._v(" The main interface provided by ServiceContextAccessor")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"primary-attribute"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#primary-attribute","aria-hidden":"true"}},[this._v("#")]),this._v(" Primary attribute")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("serviceName: string")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("The name of Service")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("config: any")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Configuration for Service, defined in "),e("code",[this._v(".service().config({ key: 'value' })")]),this._v(".")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("dependencies: { [depName: string]: Service }")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("All the Service instance that dependent.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("logger: ServiceLogger")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("Service proprietary log objects, log file to "),e("code",[this._v("${logsDir}/${appName}/service.log")]),this._v(".")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"unit-test"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#unit-test","aria-hidden":"true"}},[this._v("#")]),this._v(" Unit test")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("You can directly "),e("code",[this._v("new")]),this._v(" your implementation class to write the unit test.")])}],!1,null,null,null);n.options.__file="service_std.md";e.default=n.exports}}]);