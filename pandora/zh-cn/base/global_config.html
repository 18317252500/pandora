<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <title>全局配置 - 向未来出发</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/pandora/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/pandora/zh-cn" class="nav-logo leftpadding" alt="Pandora.js"><img src="/pandora/images/nav-logo.png" > Pandora.js</a>
    <ul class="nav-item">
      <li><a href="/pandora/zh-cn/introduce.html" alt="文档指南">文档指南</a></li><li><a href="/pandora/zh-cn/api.html" alt="API 接口">API 接口</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="发布日志">发布日志</a></li>
      <li class="translations">
        <a class="nav-link">Language - 中文</a>
        <span class="arrow" style="border-top-color:#fff" ></span>
        <ul class="dropdown-content" >
          <li style="display: block; margin-left: 20px" ><a style="color: #008ce6" href="/pandora/zh-cn">中文</a></li>
          <li style="display: block; margin-left: 20px" ><a style="color: #008ce6" href="/pandora/en">English</a></li>
        </ul>
      </li>
      <li><iframe src="https://ghbtns.com/github-btn.html?user=midwayjs&repo=pandora&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>全局配置</h1>
    <p>Pandora.js 设计了一套配置文件，希望能和应用的配置进行隔离，毕竟 Pandora.js 可能会在全局场景下应用，导致不一样的情况发生。</p>
<p>Pandora.js 设计了一套简单有效的配置覆盖机制，用户可以通过配置文件的形式，对默认的行为做一些修改。</p>
<p>我们通过 <code>PANDORA_CONFIG</code> 这个环境变量来注入配置包，这个配置包可以是一个文件，如果内容比较多，也可以是一个 npm 包，能直接 require 即可。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">PANDORA_CONFIG=pandora-ali pandora start .</span><br><span class="line">PANDORA_CONFIG=./index.js pandora start .</span><br></pre></td></tr></table></figure>
<p>文件的内容<strong>只需要写覆盖的部分</strong></p>
<h2 id="通过命令行加载多配置"><a class="markdown-anchor" href="#通过命令行加载多配置">#</a> 通过命令行加载多配置</h2>
<p>本质上，配置的覆盖就只是配置文件内容的覆盖，所以只需要做好分割就好。</p>
<p>注意：Pandora.js 使用 <code>:</code> 作为分隔符来分割多个路径。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">export</span> PANDORA_CONFIG=pandora-ali:./index.js</span><br><span class="line">$ pandora start</span><br></pre></td></tr></table></figure>
<h2 id="默认的全局配置"><a class="markdown-anchor" href="#默认的全局配置">#</a> 默认的全局配置</h2>
<p>该文件维护在 <a href="https://github.com/midwayjs/pandora/blob/master/packages/pandora/src/default.ts" target="_blank" rel="noopener">default.ts</a>.</p>
<p>Pandora.js 提供了一组默认的配置来保证基础脚本的运行，一般指定了几项标准的内容：</p>
<ul>
<li><a href="../monitor/endpoint.html">actuator 监控的配置，主要为 EndPoint</a></li>
<li><a href="../monitor/report.html">reporter 监控上报的配置</a></li>
<li><a href="../process/environment_std.html">environment 标准的环境实现类</a></li>
</ul>
<p>在这些key的基础上，进行覆盖，增加操作，默认配置如下，可能有变化，具体见代码详情。</p>
<p>下文中所有的自由变量（即没有声明来源的量，比如 DefaultEnvironment），全部可以通过 <code>require('dorapan')</code> 或 <code>require('pandora')</code> 获得。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 配置环境实现类</span></span><br><span class="line">  environment: DefaultEnvironment,</span><br><span class="line">  </span><br><span class="line">  actuator: &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// RESTful 接口进行配置</span></span><br><span class="line">    http: &#123;</span><br><span class="line">      enabled: <span class="literal">true</span>,</span><br><span class="line">      port: <span class="number">7002</span>, <span class="comment">// 默认监听在 7002 端口</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置 EndPoints</span></span><br><span class="line">    endPoint: &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 错误采集的 EndPoint</span></span><br><span class="line">      error: &#123;</span><br><span class="line">        enabled: <span class="literal">true</span>,</span><br><span class="line">        target: ErrorEndPoint,</span><br><span class="line">        resource: ErrorResource,</span><br><span class="line">        initConfig: &#123;</span><br><span class="line">          <span class="comment">// 错误缓存大小，保留最近多少条错误</span></span><br><span class="line">          maxErrorCount: <span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 健康检查的 EndPoint</span></span><br><span class="line">      health: &#123;</span><br><span class="line">        enabled: <span class="literal">true</span>,</span><br><span class="line">        target: HealthEndPoint,</span><br><span class="line">        resource: HealthResource,</span><br><span class="line">        initConfig: &#123;</span><br><span class="line">          <span class="comment">// HTTP 检查</span></span><br><span class="line">          port: &#123;</span><br><span class="line">            enabled: <span class="literal">true</span>,</span><br><span class="line">            checkUrl: <span class="string">`http://127.1:6001`</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 磁盘检查</span></span><br><span class="line">          disk_space: &#123;</span><br><span class="line">            enabled: <span class="literal">true</span>,</span><br><span class="line">            rate: <span class="number">80</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 应用信息的 EndPoint</span></span><br><span class="line">      info: &#123;</span><br><span class="line">        <span class="comment">// 应用信息</span></span><br><span class="line">        enabled: <span class="literal">true</span>,</span><br><span class="line">        target: InfoEndPoint,</span><br><span class="line">        resource: InfoResource,</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 进程信息的 EndPoint</span></span><br><span class="line">      process: &#123;</span><br><span class="line">        <span class="comment">// 进程信息</span></span><br><span class="line">        enabled: <span class="literal">true</span>,</span><br><span class="line">        target: ProcessEndPoint,</span><br><span class="line">        resource: ProcessResource,</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 自定义 Metrics 的 EndPoint</span></span><br><span class="line">      metrics: &#123;</span><br><span class="line">        enabled: <span class="literal">true</span>,</span><br><span class="line">        target: MetricsEndPoint,</span><br><span class="line">        resource: MetricsResource,</span><br><span class="line">        initConfig: &#123;</span><br><span class="line">          collector: NormalMetricsCollector</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 链路追踪的 EndPoint</span></span><br><span class="line">      trace: &#123;</span><br><span class="line">        enabled: <span class="literal">true</span>,</span><br><span class="line">        target: TraceEndPoint,</span><br><span class="line">        resource: TraceResource,</span><br><span class="line">        initConfig: &#123;</span><br><span class="line">          <span class="comment">// 缓存最近 1000 条链路</span></span><br><span class="line">          cacheSize: <span class="number">1000</span>,</span><br><span class="line">          <span class="comment">// 采样率</span></span><br><span class="line">          rate: process.env.NODE_ENV !== <span class="string">'production'</span> ? <span class="number">100</span> : <span class="number">10</span>,</span><br><span class="line">          <span class="comment">// 优先级高的链路是否跳出采样率限制，比如错误的链路</span></span><br><span class="line">          priority: <span class="literal">true</span> </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 数据上报 Reporter 的配置</span></span><br><span class="line">  reporter: &#123;</span><br><span class="line">    file: &#123;</span><br><span class="line">      enabled: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 默认实现把 Metrics 日志写到 ~/logs/pandorajs/metrics</span></span><br><span class="line">      target: FileMetricsManagerReporter,</span><br><span class="line">      interval: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 应用日志的配置</span></span><br><span class="line">  logger: &#123;</span><br><span class="line">    <span class="comment">// 日志目录</span></span><br><span class="line">    logsDir: join(homedir(), <span class="string">'logs'</span>), </span><br><span class="line">    <span class="comment">// 每个应用的日志配置，基本上就是 Stdout</span></span><br><span class="line">    appLogger: &#123; </span><br><span class="line">      <span class="comment">// 默认不输出到 Daemon 的 Stdout，请务必不要改变这一配置</span></span><br><span class="line">      stdoutLevel: <span class="string">'NONE'</span>, </span><br><span class="line">      <span class="comment">// 默认记录 Info 信息，比如应用启动停止，建议保持 INFO</span></span><br><span class="line">      level: <span class="string">'INFO'</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Service 的日志是否分散为单个日志文件，建议保持 false</span></span><br><span class="line">    isolatedServiceLogger: <span class="literal">false</span> </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="/pandora/zh-cn/introduce.html" alt="文档指南">文档指南</a></li><li><a href="/pandora/zh-cn/api.html" alt="API 接口">API 接口</a></li><li><a href="https://github.com/midwayjs/pandora/releases" alt="发布日志">发布日志</a></li></ul>
  </div>
  <dl><dt><a href="/pandora/zh-cn/introduce.html">Pandora.js 是什么？</a></dt></ul></dd><dt><a href="/pandora/zh-cn/quickstart.html">快速入门</a></dt></ul></dd><dt><a href="/pandora/zh-cn/glossary.html">关键术语</a></dt></ul></dd><dt>基础功能</dt><dd><ul><li><a href="/pandora/zh-cn/base/command.html">命令行介绍</a></li><li><a href="/pandora/zh-cn/other/dashboard.html">可视化管理面板</a></li><li><a href="/pandora/zh-cn/base/procfile_mode.html">认识 procfile.js</a></li><li><a href="/pandora/zh-cn/base/dorapan.html">用户空间 SDK - Dorapan</a></li><li><a href="/pandora/zh-cn/base/logs.html">日志管理</a></li><li><a href="/pandora/zh-cn/base/global_config.html">全局配置</a></li><li><a href="/pandora/zh-cn/base/quick_monitor.html">快速了解监控</a></li><li><a href="/pandora/zh-cn/base/debug.html">调试应用</a></li></ul></dd><dt>进程管理进阶</dt><dd><ul><li><a href="/pandora/zh-cn/process/process_std.html">自定义进程</a></li><li><a href="/pandora/zh-cn/process/service_std.html">自定义 Service</a></li><li><a href="/pandora/zh-cn/process/fork_and_cluster.html">Fork 和 Cluster</a></li><li><a href="/pandora/zh-cn/process/environment_std.html">自定义环境</a></li><li><a href="/pandora/zh-cn/process/application_life_cycle.html">应用生命周期</a></li><li><a href="/pandora/zh-cn/process/ipc_hub.html">进程间通信</a></li></ul></dd><dt>应用监控</dt><dd><ul><li><a href="/pandora/zh-cn/monitor/monitor_std.html">监控体系总览</a></li><li><a href="/pandora/zh-cn/monitor/resource.html">对外暴露的 Restful API</a></li><li><a href="/pandora/zh-cn/monitor/trace.html">链路追踪及监控</a></li><li><a href="/pandora/zh-cn/monitor/monitor_inner.html">内置的监控</a></li><li><a href="/pandora/zh-cn/monitor/endpoint.html">使用和扩展 EndPoint</a></li><li><a href="/pandora/zh-cn/monitor/metrics.html">使用和扩展 Metrics</a></li><li><a href="/pandora/zh-cn/monitor/report.html">监控数据上报</a></li></ul></dd><dt>监控数据采集</dt><dd><ul><li><a href="/pandora/zh-cn/collect/health.html">健康检查</a></li></ul></dd><dt>扩展功能</dt><dd><ul><li><a href="/pandora/zh-cn/other/typescript.html">启动 TypeScript 项目</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  e.preventDefault();
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<div class="cnzz">
<script src="https://s19.cnzz.com/z_stat.php?id=1271324644&web_id=1271324644" language="JavaScript"></script>
</div>

</html>
